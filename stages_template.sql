--  выполнить через psql -f stages_template.sql в уже работающей базе.
--
--
-- или (для Docker):
-- сначала нужно скопировать файл внутрь контейнера:
--
-- bash
-- docker cp stages_template.sql snab-postgres-1:/tmp/stages_template.sql
-- docker exec -it snab-postgres-1 psql -U snab -d snab -f /tmp/stages_template.sql
-- ( docker exec -i snab-postgres-1 psql -U snab -d snab < stages_template.sql ) - для Windows!!
--
-- Проверить можно:
--
-- docker exec -it snab-postgres-1 psql -U snab -d snab -c "SELECT id, name, code FROM projects_stagetemplate;"
-- docker exec -it snab-postgres-1 psql -U snab -d snab -c "SELECT template_id, \"order\", name FROM projects_stagetemplateline ORDER BY \"order\" LIMIT 10;"
--
--
-- 1. Создаём шаблон (если уже есть с таким code, второй INSERT просто упадёт с ошибкой – это нормально один раз)
INSERT INTO projects_stagetemplate (name, code, is_active, description, created_at, updated_at)
VALUES (
    'Шаблон закупочных этапов',
    'PROC-DEFAULT',
    TRUE,
    'Этапы проектов, по которым формируются закупки',
    NOW(),
    NOW()
);

-- 2. Берём id шаблона по коду
WITH t AS (
    SELECT id
    FROM projects_stagetemplate
    WHERE code = 'PROC-DEFAULT'
    ORDER BY id DESC
    LIMIT 1
)
INSERT INTO projects_stagetemplateline (template_id, "order", name, default_duration_days, default_offset_days)
SELECT id, o, n, NULL, NULL
FROM t
CROSS JOIN (
    VALUES
        (101, 'Расчистка, планировка, снятие плодородного слоя'),
        (102, 'Котлован, траншеи'),
        (103, 'Основание: песок, щебень, геотекстиль, уплотнение'),
        (104, 'Дренаж, ливнёвка (при наличии)'),

        (201, 'Опалубка, армирование, закладные, гильзы вводов'),
        (202, 'Бетонирование фундамента, уход'),
        (203, 'Гидроизоляция, утепление фундамента (при наличии)'),
        (204, 'Обратная засыпка, подсыпка'),
        (205, 'Отмостка (черновая/финишная)'),        

        (301, 'Нижняя обвязка, лаги, основание пола (если каркас)'),
        (302, 'Несущий каркас и стены'),
        (303, 'Перекрытия (при наличии)'),
        (304, 'Черновая лестница, усиление проёмов (при наличии)'),        

        (401, 'Стропильная система'),
        (402, 'Мембраны, обрешётка, вентзазоры'),
        (403, 'Кровельное покрытие и комплектующие'),
        (404, 'Водосточная система'),

        (501, 'Окна'),
        (502, 'Входная дверь'),
        (503, 'Герметизация узлов и примыканий'),
        (504, 'Временное отопление/осушка (при необходимости)'),        

        (601, 'Ветрозащита, мембраны, ленты'),
        (602, 'Наружное утепление (при наличии)'),
        (603, 'Подсистема/обрешётка под фасад'),
        (604, 'Наружная отделка'),
        (605, 'Софиты, наличники, доборы (если входят)'),        

        (701, 'Электрика (черновая)'),
        (702, 'Слаботочные сети (при наличии)'),
        (703, 'Водоснабжение и канализация (черновые)'),
        (704, 'Отопление (черновой монтаж)'),
        (705, 'Вентиляция и кондиционирование (черновые)'),        

        (801, 'Утепление внутренних конструкций'),
        (802, 'Пароизоляция и проклейка'),
        (803, 'Перегородки'),
        (804, 'Обшивки (ГКЛ, ОСП и др.)'),
        (805, 'Стяжки, черновые полы'),
        (806, 'Базовая штукатурка, шпаклёвка'),        

        (901, 'Чистовые потолки, финишные плоскости'),
        (902, 'Чистовые полы'),
        (903, 'Финишная отделка стен'),
        (904, 'Межкомнатные двери и погонаж'),
        (905, 'Сантехника'),
        (906, 'Электрофурнитура и свет'),
        (907, 'Кухня и встроенная мебель (если входит)'),        

        (1101, 'Дренаж/ливнёвка (финиш)'),
        (1102, 'Отмостка финишная'),
        (1103, 'Дорожки, планировка, газон'),
        (1104, 'Забор и ворота')
) AS v(o, n);
